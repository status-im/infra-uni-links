# Redirect to HTTPS
server {
  listen 80;

  server_name {{ uni_links_domain_name }};

  return 301 https://{{ uni_links_domain_name }}$request_uri;
}

# HTTPS
server {
  listen 443 default_server ssl;

  server_name {{ uni_links_domain_name }};

  # Origin certs for CloudFlare SSL proxy
  ssl_certificate     /certs/origin.crt;
  ssl_certificate_key /certs/origin.key;

  # prevent clickjacking
  proxy_set_header X-Frame-Options sameorigin;

  location / {
    proxy_pass http://127.0.0.1:{{ uni_links_cont_port }};
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Port $server_port;
  }
}
